{{ 'component-slideshow.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  #Slideshow-{{ section.id }} {
    --slide-margin: {{ section.settings.card_margin }}px;
    --slide-radius: {{ section.settings.card_radius }}px;

    /* Aspect Ratio Handling */
    --ratio-desktop: {{ section.settings.aspect_ratio_desktop }};
    --ratio-mobile: {{ section.settings.aspect_ratio_mobile }};
    height: auto;
    aspect-ratio: var(--ratio-mobile);
  }

  @media screen and (min-width: 750px) {
    #Slideshow-{{ section.id }} {
      aspect-ratio: var(--ratio-desktop);
    }
  }

  /* Full Screen Override */
  {% if section.settings.aspect_ratio_desktop == '100vh' %}
    @media screen and (min-width: 750px) {
      #Slideshow-{{ section.id }} {
        height: 100vh;
        aspect-ratio: auto;
      }
    }
  {% endif %}
  {% if section.settings.aspect_ratio_mobile == '100vh' %}
    @media screen and (max-width: 749px) {
      #Slideshow-{{ section.id }} {
        height: 100vh;
        aspect-ratio: auto;
      }
    }
  {% endif %}
{%- endstyle -%}

<div class="color-scheme-{{ section.settings.color_scheme }} section-{{ section.id }}-padding">
  <div
    id="Slideshow-{{ section.id }}"
    class="slideshow {% if section.settings.card_style %}slideshow--card{% endif %} {% if section.settings.style == 'premium' %}slideshow--premium{% endif %}"
    data-slideshow
    data-autoplay="{{ section.settings.autoplay_speed }}"
  >
    <div class="slideshow__viewport">
      {%- for block in section.blocks -%}
        <div class="slideshow__slide" {{ block.shopify_attributes }}>
          {%- comment -%} Slide Media {%- endcomment -%}
          <div
            class="slideshow__media"
            {% if block.settings.background_type == 'gradient' %}
              style="background: {{ block.settings.background_gradient }};"
            {% endif %}
          >
            {%- if block.settings.background_type == 'image' -%}
              {%- if block.settings.video != blank -%}
                {{
                  block.settings.video
                  | video_tag: autoplay: true, loop: true, muted: true, playsinline: true, controls: false, image_size: '1200x'
                }}
              {%- elsif block.settings.image != blank -%}
                <img
                  srcset="
                    {%- if block.settings.image.width >= 550 -%}{{ block.settings.image | image_url: width: 550 }} 550w,{%- endif -%}
                    {%- if block.settings.image.width >= 720 -%}{{ block.settings.image | image_url: width: 720 }} 720w,{%- endif -%}
                    {%- if block.settings.image.width >= 990 -%}{{ block.settings.image | image_url: width: 990 }} 990w,{%- endif -%}
                    {%- if block.settings.image.width >= 1100 -%}{{ block.settings.image | image_url: width: 1100 }} 1100w,{%- endif -%}
                    {%- if block.settings.image.width >= 1500 -%}{{ block.settings.image | image_url: width: 1500 }} 1500w,{%- endif -%}
                    {%- if block.settings.image.width >= 2200 -%}{{ block.settings.image | image_url: width: 2200 }} 2200w,{%- endif -%}
                    {%- if block.settings.image.width >= 3000 -%}{{ block.settings.image | image_url: width: 3000 }} 3000w,{%- endif -%}
                    {{ block.settings.image | image_url }} {{ block.settings.image.width }}w
                  "
                  src="{{ block.settings.image | image_url: width: 1500 }}"
                  alt="{{ block.settings.image.alt | escape }}"
                  sizes="100vw"
                  class="{% if block.settings.image_mobile != blank %}small-hide{% endif %}"
                  width="{{ block.settings.image.width }}"
                  height="{{ block.settings.image.width | divided_by: block.settings.image.aspect_ratio }}"
                  loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  {% if forloop.first %}
                    fetchpriority="high"
                  {% endif %}
                >
                {%- if block.settings.image_mobile != blank -%}
                  <img
                    srcset="
                      {%- if block.settings.image_mobile.width >= 375 -%}{{ block.settings.image_mobile | image_url: width: 375 }} 375w,{%- endif -%}
                      {%- if block.settings.image_mobile.width >= 550 -%}{{ block.settings.image_mobile | image_url: width: 550 }} 550w,{%- endif -%}
                      {%- if block.settings.image_mobile.width >= 750 -%}{{ block.settings.image_mobile | image_url: width: 750 }} 750w,{%- endif -%}
                      {{ block.settings.image_mobile | image_url }} {{ block.settings.image_mobile.width }}w
                    "
                    src="{{ block.settings.image_mobile | image_url: width: 750 }}"
                    alt="{{ block.settings.image_mobile.alt | escape }}"
                    sizes="100vw"
                    class="medium-hide large-up-hide"
                    width="{{ block.settings.image_mobile.width }}"
                    height="{{ block.settings.image_mobile.width | divided_by: block.settings.image_mobile.aspect_ratio }}"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                    {% if forloop.first %}
                      fetchpriority="high"
                    {% endif %}
                  >
                {%- endif -%}
              {%- else -%}
                {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            {%- endif -%}

            {%- comment -%} Overlay {%- endcomment -%}
            <div
              class="image-overlay"
              aria-hidden="true"
              style="background: {{ block.settings.overlay_color }}; opacity: {{ block.settings.overlay_opacity }}%; position: absolute; inset: 0;"
            ></div>
          </div>

          {%- comment -%} Content {%- endcomment -%}
          <div class="slideshow__content">
            <div class="slideshow__content-box">
              {%- if block.settings.title != blank -%}
                <h2 class="slideshow__title h1">{{ block.settings.title }}</h2>
              {%- endif -%}
              {%- if block.settings.text != blank -%}
                <div class="slideshow__text">{{ block.settings.text }}</div>
              {%- endif -%}
              {%- if block.settings.button_label != blank -%}
                <div class="slideshow__buttons">
                  <a href="{{ block.settings.link }}" class="button button--primary">
                    {{- block.settings.button_label -}}
                  </a>
                </div>
              {%- endif -%}
            </div>
          </div>

          {%- if block.settings.link != blank and block.settings.button_label == blank -%}
            <a href="{{ block.settings.link }}" class="slideshow__link"></a>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>

    {%- comment -%} Dot indicators {%- endcomment -%}
    {%- if section.blocks.size > 1 -%}
      <div class="slideshow__controls">
        {%- for block in section.blocks -%}
          <button
            class="slideshow__dot{% if forloop.first %} slideshow__dot--active{% endif %}"
            aria-label="Go to slide {{ forloop.index }}"
          ></button>
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if section.settings.show_arrows and section.blocks.size > 1 -%}
      <button class="slideshow__arrow slideshow__arrow--prev" aria-label="Previous Slide">
        <svg
          viewBox="0 0 24 24"
          width="24"
          height="24"
          stroke="currentColor"
          stroke-width="2"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <button class="slideshow__arrow slideshow__arrow--next" aria-label="Next Slide">
        <svg
          viewBox="0 0 24 24"
          width="24"
          height="24"
          stroke="currentColor"
          stroke-width="2"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    {%- endif -%}
  </div>
</div>

{%- comment -%}
  Lazy-load enhancement JS.
  No JS runs on page load â€” baseline is CSS scroll-snap.
  JS enhances: arrow clicks, dot sync, autoplay.
{%- endcomment -%}
{%- if section.blocks.size > 1 -%}
  <script>
    (function() {
      var loaded = false;
      function load() {
        if (loaded) return;
        loaded = true;
        var s = document.createElement('script');
        s.src = {{ 'slideshow-enhance.js' | asset_url | json }};
        document.head.appendChild(s);
      }
      // Load on first interaction or idle
      if ('requestIdleCallback' in window) {
        requestIdleCallback(load, { timeout: 3000 });
      } else {
        setTimeout(load, 2000);
      }
    })();
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Hero Slideshow",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "aspect_ratio_desktop",
      "label": "Desktop Height",
      "options": [
        { "value": "16/9", "label": "16:9" },
        { "value": "21/9", "label": "21:9" },
        { "value": "100vh", "label": "Full Screen" },
        { "value": "auto", "label": "Adapt to image" }
      ],
      "default": "21/9"
    },
    {
      "type": "select",
      "id": "aspect_ratio_mobile",
      "label": "Mobile Height",
      "options": [
        { "value": "9/16", "label": "9:16" },
        { "value": "3/4", "label": "3:4" },
        { "value": "1/1", "label": "Square" },
        { "value": "100vh", "label": "Full Screen" }
      ],
      "default": "3/4"
    },
    {
      "type": "select",
      "id": "style",
      "label": "Slideshow Style",
      "options": [
        { "value": "standard", "label": "Standard (Boxed)" },
        { "value": "premium", "label": "Premium (Cinematic)" }
      ],
      "default": "premium"
    },
    {
      "type": "checkbox",
      "id": "card_style",
      "label": "Enable Card Styling",
      "default": false
    },
    {
      "type": "range",
      "id": "card_margin",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Card Margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "card_radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Card Corner Radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Behavior"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Autoplay Speed (0 to disable)",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show Navigation Arrows",
      "default": true
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color Scheme",
      "options": [
        { "value": "1", "label": "Scheme 1" },
        { "value": "2", "label": "Scheme 2 (Inverse)" },
        { "value": "3", "label": "Scheme 3 (Accent)" }
      ],
      "default": "1"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "select",
          "id": "background_type",
          "label": "Background Type",
          "options": [
            { "value": "image", "label": "Image / Video" },
            { "value": "gradient", "label": "Color / Gradient" }
          ],
          "default": "image"
        },
        {
          "type": "color_background",
          "id": "background_gradient",
          "label": "Color / Gradient",
          "info": "Visible when 'Background Type' is set to 'Color / Gradient'."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video (Replaces Image)"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay Color",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 10,
          "unit": "%",
          "label": "Overlay Opacity",
          "default": 20
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Hero Slide"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Description",
          "default": "<p>Share your brand story.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Slideshow",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
